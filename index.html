<!DOCTYPE html>
<html lang="en">
<!--
#https://github.com/hoangco89/hoangco89.github.io/index.html
#tai xuong 15-01-26
-->
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script> <!-- Import SweetAlert2 -->
  <title>Tiensg89 Play Youtube</title>
   <link rel="stylesheet" href="index.css">
</head>
<body>
  <div class="video-container">
    <div id="playerContainer"></div>
  </div>

  <div class="menu-group">
    <select id="voiceSelect"></select>
    <button id='rateRead' onclick="tocDoDoc()">Rate: 1</button>

    <button id="playBtn">‚ñ∂Ô∏è</button>

    <button class='butp1' onclick="btnReadSub()">Sub only</button>
    <button class='butp2' onclick="btnYoutubeSound()">Yt only</button>
  </div>
  <hr>

  <div class='outiframe'>
    <br>
    <div id="currentSubtitle">[source subtitles]</div>
    <div id="loa_button">üîä</div>
    <div id="subdich">[translated subtitles ]</div>
    <br>
    <hr>
    <div id="videochon" onclick="them_Http()">JqJ7PlMCDuE</div>
    <div id="videochon_http"></div>
    <hr>

    <h5>Ch·ªçn video :</h5>
    <select id="selectVideo"></select>
    <button id="tbao" onclick="stlay_json_cde1()"></button>

    <h4>1. Ch·ªçn Ch·ªß ƒë·ªÅ :</h4>
    <select id="selectChude"></select>

    <h4>2. Nh·∫≠p Yt Url :</h4>
    <input type="text" id="inputurl" placeholder="Enter a youtube url">
    <br><button id="OK" onclick="xuLiUrlInput()">Submit</button><br>

    <!--<h4><a href="https://tien89.streamlit.app" style="background: transparent;text-align: center; ">.</a></h4>-->
    <h4><a href="z.py" style="background: transparent;text-align: center; ">.</a></h4>
  </div>

  <!-- YouTube API -->
  <script src="https://www.youtube.com/iframe_api"></script>
  <script>
    const videochon = document.getElementById("videochon");
    const playBtn =document.getElementById("playBtn");
    const selectChude = document.getElementById("selectChude");
    const selectVideo = document.getElementById("selectVideo");
    
    let player = null;

    
    function onYouTubeIframeAPIReady() {
      player = new YT.Player("playerContainer", {
        height: "315",
        width: "560",
        videoId: videochon.textContent, //`${id_video}`
        playerVars: { autoplay: 0, controls: 1 },
        events: {
          onReady: () => { },
          onStateChange: (e) => {
            if (e.data === YT.PlayerState.PAUSED) stopReading();
            if (e.data === YT.PlayerState.PLAYING) resumeSync();
            if (e.data === YT.PlayerState.ENDED) stopReading();
          }
        }
      });
    }
    window.onYouTubeIframeAPIReady = onYouTubeIframeAPIReady;

      // ==========================
      // 5. PLAY BUTTON
      // ==========================
      playBtn.addEventListener("click", async () => {
        const videoId = videochon.textContent;
        subtitles = await fetchSubtitles(videoId);
        // üî• D·ªäCH TO√ÄN B·ªò JSON
        translateFullJson(subtitles);

        player.loadVideoById(videoId);
        player.playVideo();

        startSync();
      });
      

      // ==========================
      // 6. AUTO PLAY WHEN CHANGE VIDEO
      // ==========================
    
      selectVideo.addEventListener("change", async () => {
        const chudeId = selectChude.value;
        const key = "bai_" + chudeId;
        localStorage.setItem(key, selectVideo.value);
        videochon.textContent = selectVideo.value;
        const videoId = videochon.textContent;

        subtitles = await fetchSubtitles(videoId);

        // üî• D·ªäCH TO√ÄN B·ªò JSON
        translateFullJson(subtitles);

        player.loadVideoById(videoId);
        player.playVideo();

        startSync();

      });

</script>

  <script src="index.js"></script>
</body>
</html>