<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>OCR bằng ChatGPT Vision</title>
<style>
body { font-family: Arial, sans-serif; margin: 20px; }
#preview { max-width: 300px; margin-top: 10px; }
#result { white-space: pre-wrap; margin-top: 20px; padding: 10px; border: 1px solid #ccc; }
button { margin-top: 10px; padding: 8px 16px; }
</style>
</head>
<body>

<h1>Nhận diện chữ trong ảnh</h1>

<input type="file" id="fileInput" accept="image/*">
<br><br>
<button onclick="runOCR()">Nhận diện</button>
<br><br>
<div>
<h3>Ảnh đã chọn:</h3>
<img id="preview">
</div>

<h3>Kết quả OCR:</h3>
<div id="result"></div>

<script>
let listUrlYt = ["https://youtu.be/sk=proj=epXwjLAeKPLBuTFMvjDmdQAhDVbhKcSZJ60xkDI4iF419uvhXC7GZ7jS7CHl8=OCemM293KtU5T3BlbkFJJ14i4QAWBYiJQbPMNBOMtspp8QL==mVbG2uig2oq44YGtjW9TFb3DdQuIrKYm7kNvvTnUqKoUA"];
function maHoaLaiAK(){
    let ch = listUrlYt[listUrlYt.length - 1].split("be/")[1].replaceAll("=","-");
    return ch;
}
let apiKey=maHoaLaiAK();


async function runOCR() {
const file = document.getElementById("fileInput").files[0];
if (!file) {
alert("Hãy chọn một ảnh trước");
return;
}

// Hiển thị ảnh xem trước
const preview = document.getElementById("preview");
preview.src = URL.createObjectURL(file);

// Chuyển ảnh sang base64
const base64 = await toBase64(file);

document.getElementById("result").textContent = "Đang xử lý...";

try {
const response = await fetch("https://api.openai.com/v1/chat/completions", {
method: "POST",
headers: {
"Content-Type": "application/json",
"Authorization": `Bearer ${apiKey}`
},
body: JSON.stringify({
model: "gpt-4o-mini",
messages: [
{
role: "user",
content: [
{ type: "text", text: "Hãy nhận diện toàn bộ text trong ảnh này" },
{
type: "image_url",
image_url: { url: base64 }
}
]
}
]
})
});

const data = await response.json();
const text = data.choices?.[0]?.message?.content || "Không có kết quả";

document.getElementById("result").textContent = text;

} catch (err) {
document.getElementById("result").textContent = "Lỗi: " + err.message;
}
}

function toBase64(file) {
return new Promise((resolve, reject) => {
const reader = new FileReader();
reader.onload = () => resolve(reader.result);
reader.onerror = reject;
reader.readAsDataURL(file);
});
}
</script>

</body>
</html>

