<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8" />
<title>YouTube + JSON Subtitles + TTS Sync</title>

<style>
/* LỚP NGOÀI CHỐNG SHRINK-TO-FIT CHO iPHONE */
.outer-wrapper {
  width: 100vw;
  margin-left: calc(50% - 50vw);
  margin-right: calc(50% - 50vw);
  padding: 0;
  box-sizing: border-box;
}

/* KHÔNG GIỚI HẠN CHIỀU RỘNG TRÊN MOBILE */
.video-wrapper {
  width: 100%;
  margin: 0;
  padding: 0;
}

/* Laptop mới giới hạn chiều rộng */
@media (min-width: 768px) {
  .video-wrapper {
    max-width: 800px;
    margin: 0 auto;
  }
}

/* KHUNG VIDEO CHUẨN 16:9 */
.video-container {
  position: relative;
  width: 100%;
  padding-bottom: 56.25%;
  height: 0;
  overflow: hidden;
  background: #000;
}

/* Iframe full khung */
#playerContainer iframe {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  display: block;
}

h2 {
  text-align: center;
}

.menu-group {
  margin-top: 6px;
  display: flex;
  justify-content: space-between;
  width: 100%;
}

.menu-group select {
  width: 42%;
  padding: 8px;
  font-size: 1.4rem;
}

#playBtn {
  width: 14%;
  background: whitesmoke;
}

#currentSubtitle {
  font-size: 1.6rem;
  color: darkgreen;
  text-align: right;
}

#subdich {
  font-size: 1.8rem;
  color: darkblue;
  text-align: left;
}
</style>
</head>

<body>

<div class="outer-wrapper">
<div class="video-wrapper">


  <div class="video-container">
    <div id="playerContainer"></div>
  </div>

  <div class="menu-group">
    <select id="videoSelect"></select>
    <button id="playBtn">▶</button>
    <select id="voiceSelect"></select>
  </div>

  <br>
  <div id="currentSubtitle">[source subtitles]</div>
  <br>
  <div id="subdich">[translated subtitles]</div>
  <hr>

</div>
</div>

<!-- YouTube API -->
<script src="https://www.youtube.com/iframe_api"></script>

<script>
document.addEventListener("DOMContentLoaded", () => {

  const fakeVideos = [
    { id: "0e4JjNryU90", title: "Video 1" },
    { id: "0znTbKmCRz4", title: "Video 2" },
    { id: "1ivMkhtGq4o", title: "Video 3" },
    { id: "2cjcJv2G_qg", title: "Video 4" },
    { id: "2cjcJv2G_qg", title: "Video 5" }
  ];

  const videoSelect = document.getElementById("videoSelect");
  const voiceSelect = document.getElementById("voiceSelect");

  fakeVideos.forEach(v => {
    const opt = document.createElement("option");
    opt.value = v.id;
    opt.textContent = v.title;
    videoSelect.appendChild(opt);
  });
});



  // =========================
  // 2) KHỞI TẠO YOUTUBE PLAYER
  // =========================
  let player;

  window.onYouTubeIframeAPIReady = function () {
    player = new YT.Player("playerContainer", {
      height: "100%",
      width: "100%",
      videoId: videoSelect.value,
      playerVars: { playsinline: 1 }
    });
  };

  // =========================
  // 3) LƯU & KHÔI PHỤC SELECTION
  // =========================
  function restoreSelections(voices) {
    const savedVideo = localStorage.getItem("selectedVideoId");
    const savedVoice = localStorage.getItem("selectedVoiceName");

    if (savedVideo) videoSelect.value = savedVideo;

    if (savedVoice) {
      const found = voices.find(v => v.name === savedVoice);
      if (found) voiceSelect.value = savedVoice;
    }
  }

  videoSelect.addEventListener("change", () => {
    localStorage.setItem("selectedVideoId", videoSelect.value);
    if (player) player.loadVideoById(videoSelect.value);
  });

  voiceSelect.addEventListener("change", () => {
    localStorage.setItem("selectedVoiceName", voiceSelect.value);
  });

  // =========================
  // 4) LOAD VOICES
  // =========================
  function loadVoices() {
    const voices = speechSynthesis.getVoices();
    voiceSelect.innerHTML = "";

    voices.forEach(v => {
      const opt = document.createElement("option");
      opt.value = v.name;
      opt.textContent = `${v.name} (${v.lang})`;
      voiceSelect.appendChild(opt);
    });

    restoreSelections(voices);
  }

  speechSynthesis.onvoiceschanged = loadVoices;

  // =========================
  // 5) NÚT PLAY
  // =========================
  document.getElementById("playBtn").onclick = () => {
    if (player) player.playVideo();
  };

</script>

</body>
</html>


